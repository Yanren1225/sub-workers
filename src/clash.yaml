mixed-port: 7890
allow-lan: true
mode: rule
log-level: info
external-controller: :9090
ipv6: true
# global-ua:

profile:
  store-selected: true

dns:
  enable: true
  ipv6: true
  prefer-h3: true
  listen: :53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter-mode: blacklist
  default-nameserver:
    - system
    - 119.29.29.29
    - 223.5.5.5
    - 2400:3200::1
    - 2402:4e00:3200::b
  nameserver:
    - https://cloudflare-dns.com/dns-query
    - https://dns.google/dns-query
    - tls://8.8.4.4
  fake-ip-filter:
    - '*.lan'
    - '*.local'
    - 'localhost.ptlogin2.qq.com'
    - 'www.msftconnecttest.com'
    - 'time.*.com'
    - '*.msftncsi.com'
  nameserver-policy:
    geosite:cn,apple,category-games@cn,private:
      - https://doh.pub/dns-query
      - https://dns.alidns.com/dns-query
      - 119.29.29.29
      - 223.5.5.5
      - system

sniffer:
  enable: true
  override-destination: true
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080-8888]
      active: true
    QUIC:
      ports: [443]
      active: true

proxy-providers:
  SUB:
    type: http
    interval: 86400
    health-check:
      enable: true
      lazy: false
      interval: 300
      url: https://www.gstatic.com/generate_204
    proxy: DIRECT
    url: '__SUB_URL__'
    path: ./provider_sub.yaml

proxy-groups:
  - name: PROXY
    type: select
    proxies:
      - AUTO
      - HK_AUTO
      - JP_AUTO
      - SG_AUTO
      - USA_AUTO
      - MANUAL
      - DIRECT

  - name: AUTO
    type: url-test
    url: http://www.gstatic.com/generate_204
    lazy: false
    initial: 0
    interval: 300
    tolerance: 50
    use:
      - SUB

  - name: HK_AUTO
    type: url-test
    url: http://www.gstatic.com/generate_204
    lazy: false
    initial: 0
    interval: 300
    tolerance: 50
    use:
      - SUB
    filter: '(?i)香港|HK|Hong Kong'

  - name: JP_AUTO
    type: url-test
    url: http://www.gstatic.com/generate_204
    lazy: false
    initial: 0
    interval: 300
    tolerance: 50
    use:
      - SUB
    filter: '(?i)日本|JP|Japan'

  - name: SG_AUTO
    type: url-test
    url: http://www.gstatic.com/generate_204
    lazy: false
    initial: 0
    interval: 300
    tolerance: 50
    use:
      - SUB
    filter: '(?i)新加坡|狮城|SG|Singapore'

  - name: USA_AUTO
    type: url-test
    url: http://www.gstatic.com/generate_204
    lazy: false
    initial: 0
    interval: 300
    tolerance: 50
    use:
      - SUB
    filter: '(?i)美国|US|United States'

  - name: MANUAL
    type: select
    use:
      - SUB

  - name: BLOCK
    type: select
    proxies:
      - REJECT
      - DIRECT
      - PROXY

  - name: FINAL
    type: select
    proxies:
      - PROXY
      - DIRECT

rules:
  # 自用规则
  - RULE-SET,YanrenPrivateIP,DIRECT,no-resolve
  - RULE-SET,YanrenDirect,DIRECT
  - RULE-SET,YanrenProxy,PROXY
  - RULE-SET,YanrenReject,BLOCK
  # 社区规则
  - RULE-SET,CN_Domain,DIRECT
  - RULE-SET,CN_IP,DIRECT,no-resolve
  - RULE-SET,Reject,BLOCK
  - RULE-SET,GFW,PROXY
  - RULE-SET,Telegram,PROXY
  # GEO IP
  - GEOIP,CN,DIRECT,no-resolve
  - MATCH,FINAL

rule-providers:
  YanrenProxy:
    type: http
    behavior: classical
    format: text
    url: https://github.com/Yanren1225/rules/raw/refs/heads/main/Proxy.txt
    path: ./ruleset/YanrenProxy.txt
    interval: 3600
  YanrenDirect:
    type: http
    behavior: classical
    format: text
    url: https://github.com/Yanren1225/rules/raw/refs/heads/main/Direct.txt
    path: ./ruleset/YanrenDirect.txt
    interval: 3600
  YanrenPrivateIP:
    type: http
    behavior: classical
    format: text
    url: https://github.com/Yanren1225/rules/raw/refs/heads/main/PrivateIP.txt
    path: ./ruleset/YanrenPrivateIP.txt
    interval: 3600
  YanrenReject:
    type: http
    behavior: classical
    format: text
    url: https://github.com/Yanren1225/rules/raw/refs/heads/main/Reject.txt
    path: ./ruleset/YanrenReject.txt
    interval: 3600
  Reject:
    type: http
    behavior: domain
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt
    path: ./ruleset/Adblock.txt
    interval: 3600
  CN_Domain:
    type: http
    behavior: domain
    url: 'https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/direct.txt'
    path: ./ruleset/direct.txt
    interval: 86400
  CN_IP:
    type: http
    behavior: ipcidr
    url: https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/cncidr.txt
    path: ./ruleset/cnip.txt
    interval: 86400
  GFW:
    type: http
    behavior: domain
    url: 'https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/gfw.txt'
    path: ./ruleset/gfw.txt
    interval: 86400
  Telegram:
    type: http
    behavior: ipcidr
    url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt'
    path: ./ruleset/telegramcidr.yaml
    interval: 86400
